# models/marts/users/dim_users.yml
version: 2

models:
  - name: dim_users
    description: "User-level dimension table tracking first and latest install attribution with lifetime value"
    columns:
      - name: justplay_user_id
        description: "Unique user identifier from JustPlay backend"
        data_tests:
          - not_null
          - unique
      - name: first_cohort_date
        description: "Date of user's first install"
        data_tests:
          - not_null
      - name: first_country_code
        description: "Country attributed at first install"
        data_tests:
          - not_null
      - name: first_os_name
        description: "OS at first install (ios/android)"
        data_tests:
          - accepted_values:
              values: ['ios', 'android']
      - name: first_acquisition_channel
        description: "Channel that drove first install"
        data_tests:
          - not_null
      - name: first_campaign_name
        description: "Campaign that acquired user initially"
      - name: latest_cohort_date
        description: "Date of user's most recent install"
        data_tests:
          - not_null
      - name: latest_country_code
        description: "Country attributed at latest install"
      - name: latest_os_name
        description: "OS at latest install (ios/android)"
      - name: latest_acquisition_channel
        description: "Channel that drove most recent install"
      - name: latest_campaign_name
        description: "Campaign that reactivated/reinstalled user"
      - name: ltv
        description: "Lifetime revenue generated by user in USD"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              max_value: 10000
      - name: active_days
        description: "Number of distinct days user generated revenue"
        data_tests:
          - not_null
      - name: is_payer
        description: "Binary flag: 1 if user ever generated revenue, 0 otherwise"
        data_tests:
          - accepted_values:
              values: [0, 1]
      - name: days_since_first_install
        description: "Days elapsed since initial installation"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
      - name: days_since_latest_install
        description: "Days elapsed since most recent installation"
        data_tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
      - name: is_reinstaller
        description: "Binary flag: 1 if user reinstalled (first_cohort_date != latest_cohort_date), 0 otherwise"
        data_tests:
          - accepted_values:
              values: [0, 1]